<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Tic Tac Toe Layout</title>
<style>
    body {
        margin: 0;
        padding: 0;
        display: flex;
        height: 100vh;
        background: #222;
        color: white;
        font-family: Arial, sans-serif;
    }
    .side {
        width: 20%;
        background: #333;
        display: none;
    }
    @media (min-width: 1024px) {
        .side { display: block; }
    }
    .center {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 10px;
    }
    .game-container {
        aspect-ratio: 9 / 16;
        background: #444;
        width: 100%;
        max-height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px;
        box-sizing: border-box;
        border-radius: 15px;
        position: relative;
    }
    h1 { margin: 5px 0; font-size: 24px; text-align: center; }
    a { color: #0ff; text-decoration: none; font-weight: bold; margin-bottom: 10px; }
    #themeTrigger {
        margin: 4px 0 8px;
        background:#9c27b0; color:#fff;
        border:none; padding:8px 12px;
        border-radius:8px; cursor:pointer;
    }
    .big-square {
        background: white;
        border-radius: 15px;
        width: 99%;
        aspect-ratio: 1 / 1;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
        overflow: hidden;
    }
    .board {
        position: absolute;
        width: 90%;
        aspect-ratio: 1 / 1;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 5px;
        visibility: hidden;
    }
    .cell {
        background: #999;
        border-radius: 10px;
        aspect-ratio: 1 / 1;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        user-select: none;
        overflow: hidden;
    }
    .cell img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .menu { text-align: center; }
    .menu .mode {
        display: block;
        margin: 15px auto;
        font-size: 2em;
        border-radius: 10px;
        cursor: pointer;
        border: none;
        transition: 0.3s ease;
        width: 50vw; height: 20vh;
    }
    .menu .mode-2p { background: #64b5f6; color: white; }
    .menu .mode-2p:hover { background-color: #ffb74d; }
    .menu .mode-bot { background: #2196f3; color: white; }
    .menu .mode-bot:hover { background-color: #64b5f6; }
    .winner-screen { text-align: center; display: none; }
    .winner-screen h2 { color: black; font-size: 28px; margin-bottom: 15px; }
    .winner-screen button {
        background: #4caf50; color: white;
        padding: 10px 20px; border: none;
        border-radius: 8px; cursor: pointer; font-size: 16px;
    }
    #backHome {
        margin-top: 10px;
        background: #f44336; color: white;
        padding: 8px 15px; border: none;
        border-radius: 8px; cursor: pointer; font-size: 14px;
        display: none;
    }
    .win-line {
        position: absolute;
        height: 4px;
        background: red;
        transform-origin: 0 50%;
        z-index: 10;
    }
    #themeOverlay {
        display: none;
        position: absolute;
        inset: 0;
        background: rgba(0,0,0,0.6);
        justify-content: center;
        align-items: center;
        z-index: 200;
    }
    #themeOverlay .popup {
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        width: 80%;
        max-width: 320px;
        color: #111;
    }
    #themeOverlay button {
        margin: 6px;
        padding: 10px 14px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
    }
    #themeOverlay .back-btn { background:#f44336; color:#fff; margin-top: 10px; }
</style>
</head>
<body>
<div class="side"></div>
<div class="center">
    <div class="game-container">
        <h1>Tic Tac Toe</h1>
        <a href="#" target="_blank">GOLu the GhosT</a>
        <button id="themeTrigger" onclick="openThemeMenu()">ðŸŽ­ Theme</button>
        <div class="big-square">
            <div class="board" id="board">
                <div class="cell" data-index="0"></div>
                <div class="cell" data-index="1"></div>
                <div class="cell" data-index="2"></div>
                <div class="cell" data-index="3"></div>
                <div class="cell" data-index="4"></div>
                <div class="cell" data-index="5"></div>
                <div class="cell" data-index="6"></div>
                <div class="cell" data-index="7"></div>
                <div class="cell" data-index="8"></div>
            </div>
            <div class="menu" id="menu">
                <button class="mode mode-2p" onclick="setMode('2p')">2 Players</button>
                <button class="mode mode-bot" onclick="setMode('bot')">Bot</button>
            </div>
            <div class="winner-screen" id="winnerScreen">
                <h2 id="winnerText"></h2>
                <button onclick="restartGame()">Restart</button>
            </div>
            <div id="themeOverlay">
                <div class="popup">
                    <h3>Choose Token</h3>
                    <button onclick="captureImage('X')">Set X Image</button>
                    <button onclick="captureImage('O')">Set O Image</button>
                    <br>
                    <button class="back-btn" onclick="closeThemeMenu()">â¬… Back</button>
                </div>
            </div>
        </div>
        <button id="backHome" onclick="goHome()">Back to Home</button>
    </div>
</div>
<div class="side"></div>
<video id="camera" autoplay playsinline style="display:none; width:100%; max-height:200px;"></video>
<canvas id="snapshot" style="display:none;"></canvas>

<script>
let gameMode=null, turn="X", xCells=[], oCells=[], gameOver=false;

let tokenImages={
    X: localStorage.getItem("tokenX") || null,
    O: localStorage.getItem("tokenO") || null
};

// Default funny images for tokens
const defaultImages={
    X:"1.jpg",
    O:"2.jpg"
};

const winPatterns=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];

function setMode(m){gameMode=m;menu.style.display="none";board.style.visibility="visible";backHome.style.display="inline-block";}
function checkWinner(){const c=document.querySelectorAll(".cell");for(let p of winPatterns){let[a,b,d]=p;if(c[a].dataset.symbol&&c[a].dataset.symbol===c[b].dataset.symbol&&c[a].dataset.symbol===c[d].dataset.symbol){drawWinningLine(p);setTimeout(()=>showWinner(c[a].dataset.symbol),600);return true;}}return false;}
function drawWinningLine(p){const b=board,c=document.querySelectorAll(".cell"),ra=c[p[0]].getBoundingClientRect(),rc=c[p[2]].getBoundingClientRect(),rb=b.getBoundingClientRect();const x1=ra.left+ra.width/2-rb.left,y1=ra.top+ra.height/2-rb.top,x2=rc.left+rc.width/2-rb.left,y2=rc.top+rc.height/2-rb.top;let l=document.createElement("div");l.classList.add("win-line");l.style.width=Math.hypot(x2-x1,y2-y1)+"px";l.style.transform=`translate(${x1}px,${y1}px) rotate(${Math.atan2(y2-y1,x2-x1)}rad)`;b.appendChild(l);}
function showWinner(s){gameOver=true;board.style.visibility="hidden";winnerText.textContent=`Winner: ${s}`;winnerScreen.style.display="block";backHome.style.display="none";}
function restartGame(){clearBoard();winnerScreen.style.display="none";menu.style.display="block";}
function goHome(){clearBoard();menu.style.display="block";board.style.visibility="hidden";backHome.style.display="none";closeThemeMenu(true);}
function clearBoard(){document.querySelectorAll(".cell").forEach(c=>{c.textContent="";c.innerHTML="";c.removeAttribute("data-symbol");});xCells=[];oCells=[];turn="X";gameOver=false;document.querySelectorAll(".win-line").forEach(l=>l.remove());}

function botMove(){if(gameOver)return;const c=document.querySelectorAll(".cell");let m;for(let i=0;i<c.length;i++){if(!c[i].dataset.symbol){m=i;break;}}if(m!==undefined){placeSymbol(c[m],"O");oCells.push(c[m]);if(oCells.length>3){let r=oCells.shift();r.textContent="";r.innerHTML="";r.removeAttribute("data-symbol");}if(checkWinner())return;turn="X";}}
function placeSymbol(cell,s){let img=document.createElement("img");img.src=tokenImages[s]||defaultImages[s];cell.textContent="";cell.innerHTML="";cell.appendChild(img);cell.dataset.symbol=s;}
document.querySelectorAll(".cell").forEach(cell=>cell.addEventListener("click",()=>{if(cell.dataset.symbol||gameOver)return;placeSymbol(cell,turn);if(turn==="X"){xCells.push(cell);if(xCells.length>3){let r=xCells.shift();r.textContent="";r.innerHTML="";r.removeAttribute("data-symbol");}if(checkWinner())return;turn="O";if(gameMode==="bot")setTimeout(botMove,400);}else{oCells.push(cell);if(oCells.length>3){let r=oCells.shift();r.textContent="";r.innerHTML="";r.removeAttribute("data-symbol");}if(checkWinner())return;turn="X";}}));

function openThemeMenu(){themeOverlay.style.display="flex";}
function closeThemeMenu(fromHome){themeOverlay.style.display="none";let v=camera;if(v.srcObject&&!fromHome){try{v.srcObject.getTracks().forEach(t=>t.stop());}catch(e){}}v.style.display="none";}
function captureImage(t){let v=camera;v.style.display="block";navigator.mediaDevices.getUserMedia({video:true}).then(s=>{v.srcObject=s;v.onclick=()=>{let c=snapshot,k=c.getContext("2d");c.width=v.videoWidth;c.height=v.videoHeight;k.drawImage(v,0,0,c.width,c.height);let d=c.toDataURL("image/png");tokenImages[t]=d;localStorage.setItem("token"+t,d);v.srcObject.getTracks().forEach(x=>x.stop());v.style.display="none";closeThemeMenu();};}).catch(e=>alert("Camera denied: "+e));}
</script>
</body>
</html>
